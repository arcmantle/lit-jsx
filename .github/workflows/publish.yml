name: Publish Package

on:
  workflow_dispatch:
    inputs:
      triggered-by:
        description: "What triggered this workflow"
        required: false
        type: string
        default: "manual"
      dep-map-artifact:
        description: "Artifact name containing the dependency map JSON"
        required: false
        type: string
        default: ""
      source-repo:
        description: "Source repository (owner/repo) that triggered this workflow"
        required: false
        type: string
        default: ""
      source-run-id:
        description: "Source workflow run ID"
        required: false
        type: string
        default: ""
      pre-build-script:
        description: "Custom script to run before build"
        required: false
        default: ""
        type: string
      additional-deps:
        description: "Additional build dependencies to install"
        required: false
        default: ""
        type: string
      version-increment:
        description: "Version increment type (patch, minor, major, prerelease)"
        required: false
        default: "patch"
        type: string
      node-version:
        description: "Node.js version to use"
        required: false
        default: "24"
        type: string
      access:
        description: "Package access level (public, restricted)"
        required: false
        default: "public"
        type: string

jobs:
  publish:
    uses: arcmantle/github-workflows/.github/workflows/pnpm-publish.yml@main
    with:
      triggered-by:  ${{ inputs.triggered-by }}
      dep-map-artifact: ${{ inputs.dep-map-artifact }}
      source-repo: ${{ inputs.source-repo }}
      source-run-id: ${{ inputs.source-run-id }}
      pre-build-script: ${{ inputs.pre-build-script }}
      additional-deps: ${{ inputs.additional-deps }}
      version-increment: ${{ inputs.version-increment }}
      node-version: ${{ inputs.node-version }}
      access: ${{ inputs.access }}
    secrets:
      NPM_PUBLISH: ${{ secrets.NPM_PUBLISH }}
